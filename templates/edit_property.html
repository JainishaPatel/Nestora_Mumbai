{% extends "base.html" %}

{% block title %}Post Your Property | Nestora Mumbai{% endblock %}

{% block content %}

<section class="container py-5">

    <h2 class="fw-bold mb-5">Edit Your Property</h2>

    <form class="needs-validation" novalidate action="{{ url_for('updated_property', id=property.id) }}"  method="POST" enctype="multipart/form-data">

        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="row">

            <!-- LEFT SIDE -->
            <div class="col-lg-6">
                <!-- ================= BASIC DETAILS ================= -->
                <h5 class="mb-3">Basic Details</h5>

                <label class="form-label">Property Title</label>
                <input class="form-control"
                    name="title"
                    value="{{ property.title }}"
                    placeholder="eg. 1 BHK Borivali"
                    >
                <div class="invalid-feedback">Please enter property title</div>

                <div class="row">
                    <div class="col-md-4 mt-3 mb-3">
                        <label class="form-label">Property Type</label>
                        <select class="form-select" name="property_type" >
                            <option value="" disabled selected>Select</option>
                            <option value="Rent" {% if property.property_type == "Rent" %}selected{% endif %}>Rent</option>
                            <option value="Buy" {% if property.property_type == "Buy" %}selected{% endif %}>Buy</option>
                        </select>
                        <div class="invalid-feedback">
                            Select property type
                        </div>
                    </div>

                    <div class="col-md-4 mt-3 mb-3">
                        <label class="form-label">BHK</label>
                        <select class="form-select" name="bhk" >
                            <option value="" disabled selected>Select</option>
                            <option {% if property.bhk == "1 RK" %}selected{% endif %}>1 RK</option>
                            <option {% if property.bhk == "1 BHK" %}selected{% endif %}>1 BHK</option>
                            <option {% if property.bhk == "2 BHK" %}selected{% endif %}>2 BHK</option>
                            <option {% if property.bhk == "3 BHK" %}selected{% endif %}>3 BHK</option>
                        </select>
                        <div class="invalid-feedback">
                            Select BHK
                        </div>
                    </div>

                    <div class="col-md-4 mt-3 mb-3">
                        <label class="form-label">Furnishing</label>
                        <select class="form-select" name="furnishing" >
                            <option value="" disabled selected>Select</option>
                            <option {% if property.furnishing == "Furnished" %}selected{% endif %}>Furnished</option>
                            <option {% if property.furnishing == "Semi-Furnished" %}selected{% endif %}>Semi-Furnished</option>
                            <option {% if property.furnishing == "Unfurnished" %}selected{% endif %}>Unfurnished</option>
                        </select>
                        <div class="invalid-feedback">
                            Select furnishing
                        </div>
                    </div>
                </div>

                <!-- ================= LOCATION ================= -->
                <h5 class="mt-4 mb-3">Location</h5>

                <div class="row">
                    
                    <div class="col-12 mb-3 position-relative">
                        <label class="form-label">Area</label>

                        <!-- Input that triggers dropdown -->
                        <input class="form-control" 
                            name="area"
                            value="{{ property.area }}" 
                            id="areaInput" 
                            placeholder="Select Area" 
                            readonly>
                        

                        <!-- Dropdown menu -->
                        <div class="dropdown-menu p-3 area-dropdown" id="areaDropdown">
                            <div class="row g-3">
                                {% for main_area, sub_areas in areas.items() %}
                                    <div class="col-6 col-md-4">
                                        <strong class="text-primary d-block mb-2">{{ main_area }}</strong>

                                        {% for sub_area in sub_areas %}
                                            <div class="form-check">
                                                <input class="form-check-input area-radio"
                                                    type="radio"
                                                    name="area_radio"
                                                    value="{{ sub_area }}"
                                                    id="area-{{ sub_area }}"
                                                    {% if property.area == sub_area %}checked{% endif %}>
                                                <label class="form-check-label" for="area-{{ sub_area }}">
                                                    {{ sub_area }}
                                                </label>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Direction</label>
                        <select class="form-select" name="direction" >
                            <option value="" disabled selected>Select</option>
                            <option {% if property.direction == "East" %}selected{% endif %}>East</option>
                            <option {% if property.direction == "West" %}selected{% endif %}>West</option>
                        </select>
                        <div class="invalid-feedback">
                            Select Direction
                        </div>
                    </div>
                
                    <div class="col-md-6 mb-3">
                        <label class="form-label">City</label>
                        <input class="form-control"
                            name="city"
                            value="Mumbai"
                            readonly >
                    </div>
                </div>

                <!-- ================= PRICING ================= -->
                <h5 class="mt-4 mb-3">Pricing</h5>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Price</label>
                        <input type="number"
                            class="form-control"
                            name="price"
                            value="{{ property.price }}"
                            >
                        <div class="invalid-feedback">
                            Enter price
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Price Type</label>
                        <select class="form-select" name="price_type" >
                            <option value="" disabled selected>Select</option>
                            <option value="per month" {% if property.price_type == "per month" %}selected{% endif %}>Per Month</option>
                            <option value="total" {% if property.price_type == "total" %}selected{% endif %}>Total</option>
                        </select>
                        <div class="invalid-feedback">
                            Select price type
                        </div>
                    </div>
                </div>

                <!-- ================= IMAGES ================= -->

                <h5 class="mt-4 mb-2">Image</h5>

                <label class="form-label mt-3">Property Images</label>

                <!-- Existing images preview -->
                <div class="mb-3" id="existing-images">
                    {% for img in property.images %}
                        <div class="d-inline-block position-relative me-2 mb-2 image-preview">

                            <img src="{{ img.url }}"
                                alt="Image preview"
                                class="img-thumbnail"
                                style="width: 120px; height: 100px; object-fit: cover;">

                            <button type="button"
                                    class="btn-close position-absolute top-0 end-0 remove-btn"
                                    aria-label="Remove"></button>

                            <!-- Hidden input for backend (FULL OBJECT) -->
                            <input type="hidden"
                                name="existing_images[]"
                                value='{{ img | tojson }}'>
                        </div>
                    {% endfor %}
                </div>


                <input type="file"
                    class="form-control"
                    name="images"
                    multiple>

                <small class="text-muted">
                    Hold <strong>Ctrl (Windows)</strong> / <strong>Cmd (Mac)</strong> and click to select multiple images.
                </small>

                <div class="invalid-feedback">
                    Please upload at least one image
                </div>


                <!-- ================ OWNERSHIP ================= -->
                <h5 class="mt-5 mb-3">Ownership</h5>
                <div>
                    <label class="form-label">Listed By</label>
                    <select class="form-select" name="owner_type" >
                        <option value="" disabled selected>Select</option>
                        <option value="Owner" {% if property.owner_type == "Owner" %}selected{% endif %}>Owner</option>
                        <option value="Agent" {% if property.owner_type == "Agent" %}selected{% endif %}>Agent</option>
                    </select>
                    <div class="invalid-feedback">
                        Select owner type
                    </div>
                </div>

            </div>
            
            <div class="col-lg-1 d-none d-md-flex justify-content-center">
                <div class="vr"></div>
            </div>

            <hr class="d-block d-lg-none mt-5">

            <!-- RIGHT SIDE -->
            <div class="col-lg-5">
                <!-- ================= PROPERTY INFO (OPTIONAL DETAILS) ================= -->
                <h5 class="mt-lg-0 mt-4">Property Info (Optional)</h5>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <input class="form-control" type="number" name="floor" value="{{ property.floor }}" placeholder="Floor No.">
                    </div>
                    <div class="col-md-6 mb-3">
                        <input class="form-control" type="number" name="total_floors" value="{{ property.total_floors }}" placeholder="Total Floors">
                    </div>
                    <div class="col-md-6 mb-3">
                        <input class="form-control" type="number" name="carpet_area" value="{{ property.carpet_area }}"  placeholder="Carpet Area (sq ft)">
                    </div>
                    <div class="col-md-6 mb-3">
                        <input class="form-control" name="bathrooms" value="{{ property.bathrooms }}" placeholder="No. of Bathrooms">
                    </div>

                    <div class="col-md-6 mt-3 mb-3">
                        <label class="form-label">
                            Toilet Type
                        </label>
                        <select class="form-select" name="toilet_type">
                            <option value="" disabled selected>Select</option>
                            <option {% if property.toilet_type == "Western/Sitting" %}selected{% endif %}>Western/Sitting</option>
                            <option {% if property.toilet_type == "Indian/Squat" %}selected{% endif %}>Indian/Squat</option>
                            <option {% if property.toilet_type == "Both" %}selected{% endif %}>Both</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mt-3 me-3">
                            <input class="form-control"
                                type="number"
                                name="age_of_property"
                                value="{{ property.age_of_property }}"
                                placeholder="Age of Property (years)">
                        </div>

                        <div class="col-md-3 mb-3 d-flex align-items-center">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" name="balcony" {% if property.balcony %}checked{% endif %}>
                                <label class="form-check-label">Balcony</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ================= AMENITIES ================= -->
                <h5 class="mt-4 mb-3">Amenities (Optional)</h5>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="parking" {% if property.parking %}checked{% endif %}>
                    <label class="form-check-label">Parking</label>
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="lift" {% if property.lift %}checked{% endif %}>
                    <label class="form-check-label">Lift</label>
                </div>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" name="gas_pipeline" {% if property.gas_pipeline %}checked{% endif %}>
                    <label class="form-check-label">Gas Pipeline</label>
                </div>

                <label class="form-label mt-2">Water Supply</label>
                <select class="form-select mb-3" name="water_supply">
                    <option value="" disabled selected>Select</option>
                    <option value="BMC" {% if property.water_supply == "BMC" %}selected{% endif %}>BMC</option>
                    <option value="Borewell" {% if property.water_supply == "Borewell" %}selected{% endif %}>Borewell</option>
                    <option value="Both" {% if property.water_supply == "Both" %}selected{% endif %}>Both</option>
                </select>

                <!-- ================ NEARBY FACILITIES (OPTIONAL) ================= -->
                <h5 class="mt-5 mb-3">Nearby Facilities (Optional)</h5>

                <input class="form-control mb-2" name="landmark" value="{{ property.landmark }}" placeholder="Nearby Landmark">

                <input class="form-control mb-2" name="nearby_metro" value="{{ property.nearby_metro }}" placeholder="Nearby Metro Station">

                <input class="form-control mb-2" name="nearby_school" value="{{ property.nearby_school }}" placeholder="Nearby School">

                <input class="form-control mb-3" name="nearby_hospital" value="{{ property.nearby_hospital }}" placeholder="Nearby Hospital">


                <!-- ================ CHARGES ================= -->

                <h5 class="mt-5 mb-3">Charges (Optional)</h5>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <input class="form-control"
                            type="number"
                            name="deposit"
                            value="{{ property.deposit }}"
                            placeholder="Security Deposit">
                        <small class="text-muted"> Advance money paid by the tenant, returned after leaving the house</small>
                    </div>

                    <div class="col-md-6 mb-3">
                        <input class="form-control"
                            type="number"
                            name="maintenance_charge"
                            value="{{ property.maintenance_charge }}"
                            placeholder="Maintenance Charge">
                    </div>
                </div>
                
            </div>
        </div>


        <!-- ================= SUBMIT ================= -->
        <button class="btn btn-warning btn-lg w-100 fw-bold mt-4">
            Update Property
        </button>

    </form>

</section>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/edit_property.js') }}"></script>
{% endblock %}
